# 实验三

## 1.实验准备

- 虚拟机：VIrtualBox 6.1.4 r136177 (Qt5.6.2)
- Linux系统：ubuntu 18.04.4 server 64bit
  
## 2.实验过程

### 命令篇

- 1-3
[![1-3](https://asciinema.org/a/WAnKFYgsTGKPEC93Htq22aiOk.png)](https://asciinema.org/a/WAnKFYgsTGKPEC93Htq22aiOk)
  
- 4
[![4](https://asciinema.org/a/E7xa4qFHPCVuYta9BjRp3yIDJ.png)](https://asciinema.org/a/E7xa4qFHPCVuYta9BjRp3yIDJ)

- 5-7
[![5-7](https://asciinema.org/a/Y2264eSZalcHQZeDlWQl3FbAC.png)](https://asciinema.org/a/Y2264eSZalcHQZeDlWQl3FbAC)

### 实验篇

  [![实验](https://asciinema.org/a/TKgGErSjgTilrAbpmbuyaXHxL.png)](https://asciinema.org/a/TKgGErSjgTilrAbpmbuyaXHxL)

## 3.自查清单


- 如何添加一个用户并使其具备sudo执行程序的权限？
  ```
  sudo adduser 「username」
  sudo usermod -a 「username」-G sudo
  ```


- 如何将一个用户添加到一个用户组
  ```
  sudo adduser 「username」 「groupname」
  ```

- 如何查看当前系统的分区表和文件系统详细信息？
  ```
  sudo sfdisk -l
  stat -f
  ```

- 如何实现开机自动挂载Virtualbox的共享目录分区
  
  - 在Virtualbox的共享文件夹添加共享的本地文件,勾选自动挂载和固定分配
  - 把sr0挂载到/media/cdrom里:```sudo mount /dev/sr0 /media/cdrom```
  - 配置升级:
    ```
    sudo apt-get update
    sudo apt-get install build-essential gcc make perl dkms
    ```
  - 安装增强功能并重启生效:
    ```
    sudo /media/cdrom/./VBoxLinuxAdditions.run
    reboot
    ```

  - 检验增强功能是否安装成功:```lsmod | grep vboxsf```
  - 创建ubuntu中用于共享的文件目录:```sudo mkdir /mnt/share```
  - 将本地共享文件夹挂载到指定目录:```sudo mount -t vboxsf han15179/mnt/shared```

- 基于LVM（逻辑分卷管理）的分区如何实现动态扩容和缩减容量？
  ```
  lvreduce -L -size /dev/dir
  lvextend -L +size /dev/dir
  ```

- 如何通过systemd设置实现在网络连通时运行一个指定脚本，在网络断开时运行另一个脚本？
  ```
  #打开网络连通相关的Unit
  vim /usr/lib/systemd/system/systemd-network.service

  #其[service]中添加以下内容并保存退出
  ExecStartPost=「MY_SATART_SCRIPT_PATH」
  ExecStopPost=「MY_STOP_SCRIPT_PATH」

  # 重新加载配置文件
  sudo systemctl daemon-reload

  # 重启服务
  sudo systemctl restart systemd-network.service

  # 关闭服务
  sudo systemctl stop systemd-network.service
  ```

- 如何通过systemd设置实现一个脚本在任何情况下被杀死之后会立即重新启动？实现杀不死？
  - 在```/lib/systemd/system```建立运行指定脚本的配置文件KILLME.service
    ```
    [Unit]
    Description=KILL ME PLEASE
 
    [Service]
    Type=simple
    ExecStart=MY_SCRIPT_PATH
    ExecStopPost=MY_SCRIPT_PATH
    Restart=always
    RestartSec=1
    RemainAfterExit=yes
 
    [Install]
    WantedBy=multi-user.target
    ```

  - 重新加载配置文件，然后重新启动相关服务
    ```
     # 重新加载配置文件
     sudo systemctl daemon-reload

     # 重启服务
     sudo systemctl restart KILLME.service

     # 查看服务状态，状态为active
     sudo systemctl is-active KILLME.service

     # 尝试杀死服务
     sudo sytemctl kill KILLME.service

     # 再次实验服务状态，状态仍为active，服务无法杀死
     sudo systemctl is-active KILLME.service

     # 重启，发现由于服务无法杀死而重启困难
     reboot
     ```


## 4.参考

 - [systemd.network中文手册](http://www.jinbuguo.com/systemd/systemd.network.html)